from src.Models import LRU
from src.Curve import *
from src.Task import Task

if __name__ == "__main__":
	task1, task2 = Task('bzip2'), Task('mcf')
	hit_rate1, hit_rate2 = HitRate(), HitRate()
	fetch_rate1, fetch_rate2 = FetchRate(), FetchRate()

	x_axis = [0, 262144, 524288, 786432, 1048576, 1310720, 1572864, 1835008, 2097152, 2359296, 2621440, 2883584, 3145728, 3407872, 3670016, 3932160, 4194304]
	hit_rate1.x = x_axis[:]
	hit_rate2.x = x_axis[:]
	fetch_rate1.x = x_axis[:]
	fetch_rate2.x = x_axis[:]

	hit_rate1.y = [0, 0.09163121180347437, 0.14129920945427354, 0.2105603400196372, 0.2896880927518262, 0.366880666619271, 0.44179722220324813, 0.5094198401014864, 0.5740879339607979, 0.6325625935272966, 0.6887024075350372, 0.7392051301009139, 0.7799641393869186, 0.8249584282845402, 0.856615767623324, 0.8767902404232556, 0.9071047983658025]
	fetch_rate1.y = [1, 0.9083687881965257, 0.8587007905457265, 0.7894396599803628, 0.7103119072481738, 0.633119333380729, 0.5582027777967519, 0.49058015989851356, 0.425912066039202, 0.3674374064727034, 0.31129759246496275, 0.2607948698990861, 0.2200358606130814, 0.17504157171545975, 0.14338423237667594, 0.12320975957674436, 0.09289520163419754]
	hit_rate2.y = [0, 0.23711144878335066, 0.2726248474856798, 0.32514517483745553, 0.3786694125196752, 0.4369813690335239, 0.48742049057473286, 0.5443184310099357, 0.5879165002464317, 0.6158382276258962, 0.6381213062998804, 0.6877066860562399, 0.7205577883456193, 0.730375325037848, 0.7456647765057739, 0.7401800546107947, 0.7697748181585701]
	fetch_rate2.y = [1, 0.7628885512166493, 0.7273751525143202, 0.6748548251625445, 0.6213305874803249, 0.5630186309664761, 0.5125795094252671, 0.4556815689900643, 0.4120834997535682, 0.3841617723741037, 0.3618786937001196, 0.3122933139437601, 0.2794422116543806, 0.269624674962152, 0.25433522349422616, 0.25981994538920533, 0.23022518184142995]

	hit_rate1.point_num = hit_rate2.point_num = fetch_rate1.point_num = fetch_rate2.point_num = len(x_axis)

	task1.hit_rate, task2.hit_rate = hit_rate1, hit_rate2
	task1.fetch_rate, task2.fetch_rate = fetch_rate1, fetch_rate2
	task1.calc_sticky()
	task2.calc_sticky()

	print(task1.sticky_cache.y)
	print(task2.sticky_cache.y)

	tasks, lru = [task2, task1], LRU(size=4194304, association=64, sets=2048, cache_line_size=64, shrink=512)
	lru.solve(tasks)
	tasks = [task2, task1]
	lru.solve(tasks)
